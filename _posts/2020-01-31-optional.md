---
comments: true
title: [Swift ) 옵셔널(Optional)]
key: 202001311
modify_date: 2020-07-03
picture_frame: shadow
tags:
  - [swift]
---
    
    
```
var num: Int
num = nil // error!
```
이 코드가 정상적으로 작동할까?
 
`'nil' cannot be assigned to type 'Int'` 에러가 발생한다.
에러내용을 보면 Int 타입에 nil이 올 수 없는다는 내용인데,   
> **nil**은 값이 없다는 것을 표현한다.
 
```
var num: Int?
num = nil
```
Int에 **물음표(?)** 를 붙여주니 잘 작동한다.
```
var num: Int!
num = nil
```
이번에도 역시 **느낌표(!)** 를 붙여주니 잘 작동한다.
**옵셔널 기호(?/!)** 를 붙여주면 이 변수에 값이 있을 수도 없을 수도 있기 때문에 nil을 할당해도 에러가 나지 않는 것이다.
그렇다면 옵셔널이란 뭘까?
 
## 옵셔널이란?
 
옵셔널(Optional)은 스위프트의 특징 중 하나인 **안정성**을 기반으로 하는 문법으로, 값이 있을 수도 없을 수도 있는 것을 나타낸다.   
그리고 옵셔널은 처음 선언, 즉 초기화할 때 값을 할당해주지 않아도 된다. 옵셔널이기 때문이다.   
물론 값을 할당해주지 않는다면 값은 자동적으로 nil이다.
 
옵셔널을 박스에 포장되어 있는 값이라고 생각해보자.   
그렇다면 우리가 그동안 선언한 변수는 박스에 포장되어 있지 않은 것이다.   
옵셔널은 박스를 오픈에 그 안에 있는 값을 확인하는 것인데, 오픈할 때 두가지 방법이 있다.
 
### 물음표(?)
 
**물음표(?)** 로 포장된 것은 먼저 노크를 해 값이 있는지, 없는지 대답을 들어 확인하는 방법이다.   
값이 있다면 값을 반환하고, 값이 없다면 nil을 반환한다.   
*참고로 nil도 메모리 차지를 한다.*
 
```
var num: Int? = 5
```
이제 이러한 코드를 보면 알 수 있다.   
**num이라는 변수에는 Int값이 올 수도 있고, nil이 올 수도 있다.**
```
var num: Int? = 5
var new = num
```
만약 옵셔널타입인 num을 new라는 새로운 변수에 할당해준다면 new는...?
옵셔널타입을 할당받는 순간 **new**라는 변수도 마찬가지로 옵셔널타입이 된다.   
`var new: Int`라고 해도 이미 new는 Int?타입이기 때문에 에러가 난다.
 
### 느낌표(!)
 
**느낌표(!)** 로 포장된 포장된 것은 값이 있든 없든 포장을 깨부시고 확인하는 방법으로, **강제 언랩핑**이라고도 한다.
깨부셨을 때 값이 있으면 있는 것이고, 없으면 없는 값의 유무를 상관하지 않는 방법이라고 할 수 있다.   
```
var num: Int? = 5
var new = num!
```
이렇게 된다면 new는 어떤 타입일까?   
옵셔널타입인 num을 깨부시고 안에 있는 값을 할당한 것이니, **new는 Int타입**이다.
```
var num: Int? = nil
var new: Int = num! // error!
```
num은 옵셔널타입이기 때문에 nil을 할당할 수 있다. 그러나, new는 Int타입이기 때문에 `Unexpectedly found nil while unwrapping an Optional value` 이라는 에러가 발생한다.
```
var num: Int? = nil
var new = num! // error!
```
이 역시도 같은 에러가 발생한다. 왤까?   
nil이라는 값에 접근하려고 하면 100% 런타임 에러가 발생한다.   
**즉!! 웬만하면 느낌표(!)는 사용하지 말자.**   
**옵셔널 바인딩이나 체이닝으로 매번 값을 추출하기 귀찮거나, 로직상 절대 nil이 할당되지 않을 것 같을 때에만 사용하자.**   
 
그래서 나는 느낌표(!)가 붙는 것을 보고 "얘는 무조건 값 있다! 없으면 런타임 에러." 이렇게 해석하기로 했다.   
그리고 물음표(?)가 붙은 것은 "얘는 값이 있을 수도 있고, 없을 수도 있어. 할당할거면 확인해봐" 이렇게 해석하고 있다.   
좀 웃기지만 이렇게 해석하는게 가장 이해가 잘 된다.   
 
강제 언랩핑(!)만을 사용해야 하는 경우도 있는데 바로 **@IBOutlet**,
UI를 변수에 연결할 때에는 연결되었다는 것을 확실히 해야하기 때문에 강제 언랩핑만을 해야 한다.
 
그렇다면 안전하게 옵셔널값을 가져올 수 있는 방법에 대해 알아보자.
 
## 옴셔널 바인딩
 
옵셔널 바인딩은 옵셔널타입 변수에 값이 있는지, 없는지 **먼저 확인해주는 작업**을 말한다.   
확인한 후 값이 있을 때와 없을 때 다르게 코드를 실행시킬 수 있다.
```
if let 값이 있다면 값을 할당할 변수 = 옵셔널타입 변수 {
    // 값이 있을 때 실행할 코드
} else {
    // 값이 없을 때(nil일 때) 실행할 코드
}
```
기본코드는 이렇게 구성되어 있는데 `if let`도 결국 if 기반 구문이기 때문에 `else`구문을 생략할 수 있다.
```
if let 값이 있다면 값을 할당할 변수 = 옵셔널타입 변수 {
    // 값이 있을 때 실행할 코드
}
```
만약 이렇게 `if let`으로만 구성되어 있다면 값이 없을 때 실행될 코드는 없는 것이다.
물론 `if var`라고 사용할 수 있지만 옵셔널 바인딩을 할 때는 거의 해당 값에 값을 주려는 것보다 값을 사용하는 경우가 많기 때문에 `if let`을 훨씬 많이 본 것이다.   
```
if let 값이 있다면 값을 할당할 변수1 = 옵셔널타입 변수1, 값이 있다면 값을 할당할 변수2 = 옵셔널타입 변수2 {
    // 두 변수 모두 값이 있을 때 실행할 코드
}
```
그리고 말했듯이 if 기반 구문이기 때문에 &&를 할용할 수 있다.   
*(&& 대신 , 쓸 수 있는 건 다 알겠죠..?)*
 
## 옵셔널 체이닝
 
옵셔널 체이닝은 하위 프로퍼티에 옵셔널 값이 있는지 마침표(.)을 통해 **연속적**으로 체이닝하여 확인할 수 있는 방법이다.   
**중간에 nil 값이 하나라도 발견된다면 전체 반환값이 nil로 반환된다.**
```
class SomeClass {
    var some = "some"
}
 
class OtherClass {
    var other: SomeClass?
}
 
let value = OtherClass()
print(value.other?.some) // nil
```
바로 `value.other?.some` 이 부분을 옵셔널 체이닝이라고 한다.   
other라는 변수가 초기화(선언)할 때 SomeClass를 옵셔널 값으로 상속하고 있어 중간에 other가 값이 없는 것이고, 고로 `value.other?.some` 값이 nil을 반환한 것이다.   
또한 애초에 마지막 코드라인을 작성할 때 **other가 옵셔널이니 wrapping을 하라는 warning**이 뜬다.
```
let value = OtherClass()
let optional = value.other?.some
```
other가 옵셔널 값이고 옵셔널 체이닝의 전체 반환값이 nil이기 때문에 ptional이라는 변수 역시 String? 타입으로 초기화(선언)된다.
```
class OtherClass {
    var other = SomeClass()
}

let value = OtherClass()
print(value.other.some) // some
```
만약 옵셔널이 아닌 SomeClass 자체로 other를 초기화한다면 other가 nil이 아니기 때문에 잘 작동한다.
 
*사실 나는 실제 프로젝트에서 옵셔널을 확인할 때 옵셔널 바인딩을 많이 사용하기도 하지만, print를 통해 출력해보고 "어? 없네"하고 코드를 수정하거나 옵셔널 바인딩을 하곤 한다.*
    
 
#### 마무리로, 옵셔널은 스위프트의 특징 중에서 안정성(Safe)를 보장하기 위한 문법이고, 옵셔널이 존재함으로써 옵셔널이 아닌 타입은 무조건 데이터가 존재할 것이라고 보장할 수 있다.
    
 
#### Reference)
 
[https://zeddios.tistory.com/16](https://zeddios.tistory.com/16)
